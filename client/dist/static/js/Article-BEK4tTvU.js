import{NTabPane as M,NCard as j,NSpace as L,NButton as V,NForm as B,NFormItem as y,NInput as I,NSelect as O,NTabs as G}from"naive-ui";import{T as K,E as X}from"./@wangeditor-BUvCUWhg.js";import{i as E,s as Y,r as x,w as z,a as _,c as b,B as l,u as o,f as T,o as q,A as n,F as H,E as D,D as k,H as S,G as C,I as J}from"./@vue-B4preGn0.js";const Q={style:{border:"1px solid #ccc","margin-top":"10px"}},A={__name:"RichTextEditor",props:{modelValue:{type:String,default:""},clearCommand:{type:Boolean,default:!1}},emits:["update:model-value"],setup(F,{emit:m}){const u=E("server_url"),p=Y(),c=x(),v=x("default"),i={excludeKeys:["uploadVideo"]},g={placeholder:"请输入内容..."};g.MENU_CONF={},g.MENU_CONF.uploadImage={base64LimitSize:10*1024,server:u+"/upload/rich_editor_upload"},g.MENU_CONF.insertImage={parseImageSrc:d=>d.indexOf("Http")!==0?`${u}${d}`:d},g.MENU_CONF.codeSelectLang={codeLangs:[{text:"CSS",value:"css"},{text:"HTML",value:"html"},{text:"XML",value:"xml"}]};const f=F,U=m,r=d=>{console.log("created",d),p.value=d},s=d=>{U("update:model-value",c.value)};return z(()=>f.modelValue,d=>{d!==c.value&&(c.value=d)},{immediate:!0}),z(()=>f.clearCommand,d=>{d&&(c.value="",console.log("clear"))},{immediate:!0}),(d,N)=>(_(),b("div",Q,[l(o(K),{editor:p.value,defaultConfig:i,mode:v.value,style:{"border-bottom":"1px solid #ccc"}},null,8,["editor","mode"]),l(o(X),{defaultConfig:g,mode:v.value,modelValue:c.value,"onUpdate:modelValue":N[0]||(N[0]=$=>c.value=$),style:{height:"400px","overflow-y":"hidden"},onOnCreated:r,onOnChange:s},null,8,["mode","modelValue"])]))}},W=["onClick"],Z=["innerHTML"],le={__name:"Article",setup(F){const m=E("axios"),u=E("message"),p=x([]),c=x(!1),v=x("list"),i=T({page:1,pageSize:3,pageCount:0,count:0});let g=x([]);q(()=>{U(),f()});const f=async()=>{let a=await m.get(`/blog/search?page=${i.page}&pageSize=${i.pageSize}`),e=a.data.rows;for(let t of e){t.content+="...";let w=new Date(t.create_time);t.create_time=`${w.getFullYear()}/${w.getMonth()+1}/${w.getDate()}`}g.value=e,console.log(a),i.count=a.data.count,i.pageCount=Math.ceil(i.count/i.pageSize),console.log(i)},U=async()=>{let a=await m.get("/category/list");p.value=a.data.rows.map(e=>({label:e.name,value:e.id})),console.log(p.value)},r=T({content:"hello",title:"",categoryid:""}),s=T({id:"",title:"",categoryid:"",content:""}),d=async()=>{try{let a=await m.post("/blog/_token/add",{title:r.title,categoryId:r.categoryid,content:r.content});console.log(a),a.data.code==200?(u.success(a.data.msg),r.title="",r.categoryid="",c.value=!0,console.log("command"),setTimeout(()=>c.value=!1,0)):u.error(a.data.msg)}catch(a){u.error(a.response.data.msg)}},N=async a=>{i.page=a,f()},$=async a=>{v.value="update";let e=await m.get("/blog/detail?id="+a.id);console.log(e),s.id=a.id,s.title=e.data.rows[0].title,s.content=e.data.rows[0].content,s.categoryid=e.data.rows[0].category_id},R=async a=>{try{let e=await m.delete("/blog/_token/delete?id="+a.id);e.data.code==200?(u.success(e.data.msg),f()):u.error(e.data.msg)}catch(e){u.error(e.response.data.msg)}},h=async()=>{try{let a=await m.post("/blog/_token/update",s);console.log(a),a.data.code==200?(u.success(a.data.msg),v.value="list",f()):u.error(a.data.msg)}catch(a){u.error(a.response.data.msg)}};return(a,e)=>(_(),b("div",null,[l(o(G),{value:v.value,"onUpdate:value":e[7]||(e[7]=t=>v.value=t),type:"line",animated:""},{default:n(()=>[l(o(M),{name:"list",tab:"文章列表"},{default:n(()=>[(_(!0),b(H,null,D(o(g),(t,w)=>(_(),b("div",null,[l(o(j),{title:t.title},{footer:n(()=>[l(o(L),{align:"center"},{default:n(()=>[k("div",null,S(t.create_time),1),l(o(V),{onClick:P=>$(t)},{default:n(()=>e[8]||(e[8]=[C("修改")])),_:2},1032,["onClick"]),l(o(V),{onClick:P=>R(t)},{default:n(()=>e[9]||(e[9]=[C("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[C(S(t.content)+" ",1)]),_:2},1032,["title"])]))),256)),l(o(L),null,{default:n(()=>[(_(!0),b(H,null,D(i.pageCount,t=>(_(),b("div",{onClick:w=>N(t),style:J({color:t===i.page?"green":"black"})},S(t),13,W))),256))]),_:1})]),_:1}),l(o(M),{name:"add",tab:"添加文章"},{default:n(()=>[l(o(B),null,{default:n(()=>[l(o(y),{label:"标题"},{default:n(()=>[l(o(I),{value:r.title,"onUpdate:value":e[0]||(e[0]=t=>r.title=t),placeholder:"输入标题"},null,8,["value"])]),_:1}),l(o(y),{label:"分类"},{default:n(()=>[l(o(O),{value:r.categoryid,"onUpdate:value":e[1]||(e[1]=t=>r.categoryid=t),options:p.value},null,8,["value","options"])]),_:1}),l(o(y),{label:"内容"},{default:n(()=>[l(A,{modelValue:r.content,"onUpdate:modelValue":e[2]||(e[2]=t=>r.content=t),clearCommand:c.value},null,8,["modelValue","clearCommand"])]),_:1}),C(" "+S(r.content),1)]),_:1}),k("div",null,[l(o(V),{onClick:e[3]||(e[3]=t=>d())},{default:n(()=>e[10]||(e[10]=[C("添加")])),_:1})])]),_:1}),l(o(M),{name:"update",tab:"修改文章"},{default:n(()=>[l(o(B),null,{default:n(()=>[l(o(y),{label:"标题"},{default:n(()=>[l(o(I),{value:s.title,"onUpdate:value":e[4]||(e[4]=t=>s.title=t),placeholder:"输入标题"},null,8,["value"])]),_:1}),l(o(y),{label:"分类"},{default:n(()=>[l(o(O),{value:s.categoryid,"onUpdate:value":e[5]||(e[5]=t=>s.categoryid=t),options:p.value},null,8,["value","options"])]),_:1}),l(o(y),{label:"内容"},{default:n(()=>[l(A,{modelValue:s.content,"onUpdate:modelValue":e[6]||(e[6]=t=>s.content=t),clearCommand:c.value},null,8,["modelValue","clearCommand"])]),_:1}),k("div",{innerHTML:s.content},null,8,Z)]),_:1}),k("div",null,[l(o(V),{onClick:h},{default:n(()=>e[11]||(e[11]=[C("修改")])),_:1})])]),_:1})]),_:1},8,["value"])]))}};export{le as default};
