import{T as _,E as k}from"./@wangeditor-Df5DrFoU.js";const b={style:{border:"1px solid #ccc","margin-top":"10px"}},C={__name:"RichTextEditor",props:{modelValue:{type:String,default:""},clearCommand:{type:Boolean,default:!1}},emits:["update:model-value"],setup(N,{emit:i}){const n=Vue.inject("server_url"),c=Vue.shallowRef(),d=Vue.ref(),s=Vue.ref("default"),r={excludeKeys:["uploadVideo"]},V={placeholder:"请输入内容..."};V.MENU_CONF={},V.MENU_CONF.uploadImage={base64LimitSize:10*1024,server:n+"/upload/rich_editor_upload"},V.MENU_CONF.insertImage={parseImageSrc:o=>o.indexOf("Http")!==0?`${n}${o}`:o},V.MENU_CONF.codeSelectLang={codeLangs:[{text:"CSS",value:"css"},{text:"HTML",value:"html"},{text:"XML",value:"xml"}]};const m=N,p=i,l=o=>{console.log("created",o),c.value=o},u=o=>{p("update:model-value",d.value)};return Vue.watch(()=>m.modelValue,o=>{o!==d.value&&(d.value=o)},{immediate:!0}),Vue.watch(()=>m.clearCommand,o=>{o&&(d.value="",console.log("clear"))},{immediate:!0}),(o,f)=>(Vue.openBlock(),Vue.createElementBlock("div",b,[Vue.createVNode(Vue.unref(_),{editor:c.value,defaultConfig:r,mode:s.value,style:{"border-bottom":"1px solid #ccc"}},null,8,["editor","mode"]),Vue.createVNode(Vue.unref(k),{defaultConfig:V,mode:s.value,modelValue:d.value,"onUpdate:modelValue":f[0]||(f[0]=g=>d.value=g),style:{height:"400px","overflow-y":"hidden"},onOnCreated:l,onOnChange:u},null,8,["mode","modelValue"])]))}},h=["onClick"],B=["innerHTML"],E={__name:"Article",setup(N){const i=Vue.inject("axios"),n=Vue.inject("message"),c=Vue.ref([]),d=Vue.ref(!1),s=Vue.ref("list"),r=Vue.reactive({page:1,pageSize:3,pageCount:0,count:0});let V=Vue.ref([]);Vue.onMounted(()=>{p(),m()});const m=async()=>{let a=await i.get(`/blog/search?page=${r.page}&pageSize=${r.pageSize}`),e=a.data.rows;for(let t of e){t.content+="...";let v=new Date(t.create_time);t.create_time=`${v.getFullYear()}/${v.getMonth()+1}/${v.getDate()}`}V.value=e,console.log(a),r.count=a.data.count,r.pageCount=Math.ceil(r.count/r.pageSize),console.log(r)},p=async()=>{let a=await i.get("/category/list");c.value=a.data.rows.map(e=>({label:e.name,value:e.id})),console.log(c.value)},l=Vue.reactive({content:"hello",title:"",categoryid:""}),u=Vue.reactive({id:"",title:"",categoryid:"",content:""}),o=async()=>{try{let a=await i.post("/blog/_token/add",{title:l.title,categoryId:l.categoryid,content:l.content});console.log(a),a.data.code==200?(n.success(a.data.msg),l.title="",l.categoryid="",d.value=!0,console.log("command"),setTimeout(()=>d.value=!1,0)):n.error(a.data.msg)}catch(a){n.error(a.response.data.msg)}},f=async a=>{r.page=a,m()},g=async a=>{s.value="update";let e=await i.get("/blog/detail?id="+a.id);console.log(e),u.id=a.id,u.title=e.data.rows[0].title,u.content=e.data.rows[0].content,u.categoryid=e.data.rows[0].category_id},x=async a=>{try{let e=await i.delete("/blog/_token/delete?id="+a.id);e.data.code==200?(n.success(e.data.msg),m()):n.error(e.data.msg)}catch(e){n.error(e.response.data.msg)}},y=async()=>{try{let a=await i.post("/blog/_token/update",u);console.log(a),a.data.code==200?(n.success(a.data.msg),s.value="list",m()):n.error(a.data.msg)}catch(a){n.error(a.response.data.msg)}};return(a,e)=>(Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(Vue.unref(naive.NTabs),{value:s.value,"onUpdate:value":e[7]||(e[7]=t=>s.value=t),type:"line",animated:""},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NTabPane),{name:"list",tab:"文章列表"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(V),(t,v)=>(Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(Vue.unref(naive.NCard),{title:t.title},{footer:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NSpace),{align:"center"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,Vue.toDisplayString(t.create_time),1),Vue.createVNode(Vue.unref(naive.NButton),{onClick:w=>g(t)},{default:Vue.withCtx(()=>e[8]||(e[8]=[Vue.createTextVNode("修改")])),_:2},1032,["onClick"]),Vue.createVNode(Vue.unref(naive.NButton),{onClick:w=>x(t)},{default:Vue.withCtx(()=>e[9]||(e[9]=[Vue.createTextVNode("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(t.content)+" ",1)]),_:2},1032,["title"])]))),256)),Vue.createVNode(Vue.unref(naive.NSpace),null,{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(r.pageCount,t=>(Vue.openBlock(),Vue.createElementBlock("div",{onClick:v=>f(t),style:Vue.normalizeStyle({color:t===r.page?"green":"black"})},Vue.toDisplayString(t),13,h))),256))]),_:1})]),_:1}),Vue.createVNode(Vue.unref(naive.NTabPane),{name:"add",tab:"添加文章"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NForm),null,{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NFormItem),{label:"标题"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NInput),{value:l.title,"onUpdate:value":e[0]||(e[0]=t=>l.title=t),placeholder:"输入标题"},null,8,["value"])]),_:1}),Vue.createVNode(Vue.unref(naive.NFormItem),{label:"分类"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NSelect),{value:l.categoryid,"onUpdate:value":e[1]||(e[1]=t=>l.categoryid=t),options:c.value},null,8,["value","options"])]),_:1}),Vue.createVNode(Vue.unref(naive.NFormItem),{label:"内容"},{default:Vue.withCtx(()=>[Vue.createVNode(C,{modelValue:l.content,"onUpdate:modelValue":e[2]||(e[2]=t=>l.content=t),clearCommand:d.value},null,8,["modelValue","clearCommand"])]),_:1}),Vue.createTextVNode(" "+Vue.toDisplayString(l.content),1)]),_:1}),Vue.createElementVNode("div",null,[Vue.createVNode(Vue.unref(naive.NButton),{onClick:e[3]||(e[3]=t=>o())},{default:Vue.withCtx(()=>e[10]||(e[10]=[Vue.createTextVNode("添加")])),_:1})])]),_:1}),Vue.createVNode(Vue.unref(naive.NTabPane),{name:"update",tab:"修改文章"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NForm),null,{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NFormItem),{label:"标题"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NInput),{value:u.title,"onUpdate:value":e[4]||(e[4]=t=>u.title=t),placeholder:"输入标题"},null,8,["value"])]),_:1}),Vue.createVNode(Vue.unref(naive.NFormItem),{label:"分类"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NSelect),{value:u.categoryid,"onUpdate:value":e[5]||(e[5]=t=>u.categoryid=t),options:c.value},null,8,["value","options"])]),_:1}),Vue.createVNode(Vue.unref(naive.NFormItem),{label:"内容"},{default:Vue.withCtx(()=>[Vue.createVNode(C,{modelValue:u.content,"onUpdate:modelValue":e[6]||(e[6]=t=>u.content=t),clearCommand:d.value},null,8,["modelValue","clearCommand"])]),_:1}),Vue.createElementVNode("div",{innerHTML:u.content},null,8,B)]),_:1}),Vue.createElementVNode("div",null,[Vue.createVNode(Vue.unref(naive.NButton),{onClick:y},{default:Vue.withCtx(()=>e[11]||(e[11]=[Vue.createTextVNode("修改")])),_:1})])]),_:1})]),_:1},8,["value"])]))}};export{E as default};
